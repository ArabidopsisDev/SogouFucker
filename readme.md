# 搜狗输入法流氓组件清理与封锁工具使用手册 (v2)

从操作系统的安全防御逻辑和软件工程的最小权限原则（Principle of Least Privilege）来看，搜狗输入法目前表现出的部分行为确经显著超越了普通应用软件的边界，甚至在某些机制上与隐蔽软件（Greyware）或恶意软件的对抗手段非常相似。

本工具包通过 Windows 权限控制机制，将搜狗输入法的非核心组件（广告、下载、监控、修复程序）彻底锁死。它不删除文件，而是剥夺其运行权限，从而规避搜狗的自动修复机制。

---

## 1. 工具清单

| 文件名 | 类型 | 功能说明 |
| :--- | :--- | :--- |
| **`SealSogou.bat`** | 主程序 | 封锁版本目录（如 `15.6.0.2020`）下的核心扩展组件。 |
| **`SealResurrection.bat`** | 补丁程序 | 专门针对 `Temp` 目录下的 `sgrepairbackup` 自动修复基地进行“断根”处理。 |

---

## 2. 使用方法

### 第一步：执行主封锁 (`SealSogou.bat`)
1.  找到搜狗安装目录下的**版本号文件夹**（例如：`D:\Input_Method\15.6.0.2020`）。
2.  右键点击 `SealSogou.bat`，选择 **“以管理员身份运行”**。
3.  根据提示粘贴上述路径并回车。
4.  **预期结果**：脚本可能会提示 `[Failed]`，这是由于权限锁死后管理员也无法读取文件状态导致的“误报”。只要手动双击目录下的 `PinyinUp.exe` 弹出“**Windows 无法访问...**”报错，即代表封锁成功。

### 第二步：封锁再生路径 (`SealResurrection.bat`)
为了防止搜狗通过 `Temp` 文件夹释放安装包“原地复活”，请执行此补丁：
1.  右键点击 `SealResurrection.bat`，选择 **“以管理员身份运行”**。
2.  脚本会自动清理 `C:\Users\用户名\AppData\Local\Temp\sgrepairbackup` 并创建一个**不可写、不可删除的占位文件**。
3.  **预期结果**：搜狗将无法再创建该目录来存放修复包。

---

## 3. 核心行为与组件分析报告

### A. 自我修复与热更新机制 
*   **`PinyinUp.exe` (组件监工)**：负责实时校验版本目录下的组件完整性。一旦发现组件被禁用，会尝试从云端或备份中拉起修复。
*   **`sgrepairbackup` (再生基地)**：位于用户 `Temp` 目录下的隐藏文件夹。搜狗会将 `installbak.exe` 等静默安装包释放至此，利用临时权限绕过主目录的封锁逻辑进行“二次重装”。

### B. 联网与资源占用类
*   **`SGDownload.exe` (静默下载器)**：在后台下载皮肤、词库以及搜狗关联推广软件的素材包。
*   **`sogou_torrent.dll` (分发协议库)**：集成点对点传输协议。在下载大型素材时，可能会占用用户的上传带宽作为节点，以优化服务端的成本。
*   **`userNetSchedule.exe` (网络任务调度)**：协调各个非核心组件的联网优先级，确保统计数据与云端指令的上传。

### C. 商业交互与系统侵入类
*   **`SGBizLauncher.exe` (商业业务启动器)**：负责拉起非输入法功能的节日弹窗、资讯窗口和商业推广页面。
*   **`SGWangzai.exe` (汪仔助手)**：常驻后台的辅助组件，提供语义扫描和表情推荐，会消耗额外的系统内存资源。
*   **右键菜单劫持 (Sparse Package)**：在 Windows 11 中，利用稀疏包技术强制在右键菜单一级路径插入“切换壁纸”等非核心功能，且不提供原生关闭选项。

---

## 4. 常见问题 (FAQ)

**Q：为什么脚本运行完显示 Failed？**
**A**：这是权限锁死后的正常现象。脚本执行完拒绝指令后，由于管理员账户也失去了读取权限，脚本无法再次校验文件，从而产生报错。只要文件属性页显示“无法查看权限”，即代表封锁已稳固。

**Q：我想升级搜狗输入法怎么办？**
**A**：由于文件被锁死，官方升级包会因无法覆盖文件而报错。你需要先运行恢复权限命令（`icacls "文件名" /grant Everyone:(F)`），或者卸载后重新安装，再重新运行本脚本。

**Q：右键菜单还在怎么办？**
**A**：运行完脚本后，请在任务管理器中重启 **“Windows 资源管理器”**，或直接重启电脑，系统会自动清理失效的注册表入口。

---

**提示：** 若搜狗发布了新的大版本（路径变动），你需要针对新路径重新运行一次 `SealSogou.bat`。如果发生反封锁行为，请下载新版本的脚本。
